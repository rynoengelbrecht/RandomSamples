SELECT
    pt.name AS PluginTypeName,
    s.name AS StepName,
    m.name AS Message,                      -- Create / Update
    CASE s.stage
        WHEN 10 THEN 'Pre-Validation'
        WHEN 20 THEN 'Pre-Operation'
        WHEN 40 THEN 'Post-Operation'
        ELSE 'Stage ' + CAST(s.stage AS VARCHAR(10))
    END AS OperationStage,
    CASE s.mode
        WHEN 0 THEN 'Synchronous'
        WHEN 1 THEN 'Asynchronous'
        ELSE 'Mode ' + CAST(s.mode AS VARCHAR(10))
    END AS ExecutionMode,
    s.rank AS StepOrder,
    s.filteringattributes AS FilteringAttributes
FROM
    sdkmessageprocessingstep AS s
    INNER JOIN sdkmessage AS m
        ON s.sdkmessageid = m.sdkmessageid
    INNER JOIN sdkmessagefilter AS f
        ON s.sdkmessagefilterid = f.sdkmessagefilterid
    INNER JOIN plugintype AS pt
        ON s.plugintypeid = pt.plugintypeid
WHERE
    f.primaryobjecttypecode = 'account'
    AND m.name IN ('Create', 'Update')
    AND s.statecode = 0 -- active steps only (optional)
ORDER BY
    m.name,
    OperationStage,
    ExecutionMode,
    s.rank;
